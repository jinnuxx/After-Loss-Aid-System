// generatePdf.js
import { jsPDF } from "jspdf";
import { Canvg } from "canvg";

const generatePdf = (organisationName, state) => {
  const doc = new jsPDF({
    format: "a4",
  });
  const buttonLines = [
    "                     vale.rest",
    "          Vale Innovations Pty Ltd",
    "   Incubate Hub, University of Sydney",
    "        Level 4, Wentworth Building",
    "                  2 Butlin Avenue",
    "             Darlington NSW 2008",
  ];
  let posX = 0;
  let posY = 0;
  let width = 400;
  let height = 8;

  const deceasedName =
    sessionStorage.getItem("given-name") +
    " " +
    sessionStorage.getItem("last-name");
  const role = sessionStorage.getItem("typeOfRole");
  const reporterName =
    sessionStorage.getItem("userGivenName") +
    " " +
    sessionStorage.getItem("userLastName");
  let header =
    '<svg width="600" height="53" viewBox="0 0 600 53" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="600" height="53" fill="#1E2B55"/><g clip-path="url(#clip0_0_3727)"><path d="M30.2267 30.4686C29.129 29.2176 27.3352 26.4979 26.7373 25.6611C26.5195 25.3557 26.2547 25.113 26.0113 24.8912C25.5457 24.4686 24.9264 24.1465 24.2644 23.8076C23.359 23.3389 22.3468 22.7992 21.5011 21.8912C21.4798 23.0879 21.7574 24.477 22.3639 26.0502C24.4737 31.523 29.4451 36 30.4957 36C30.9485 36 32.4347 35.0168 34.2926 32.9205C34.2926 32.9205 34.1346 33.0126 33.857 33C32.1913 32.9163 30.7306 30.9331 30.2267 30.4686Z" fill="#22A0C2"/><path d="M39.4905 21.8954C39.4905 21.8912 39.4905 21.887 39.4905 21.887C38.6448 22.7991 37.6326 23.3389 36.7272 23.8033C36.0694 24.1422 35.4459 24.4644 34.9846 24.887C34.9804 24.8912 34.9761 24.8954 34.9718 24.8995C34.9419 24.9288 34.9163 24.9581 34.8864 24.9874C34.6728 25.1841 34.455 25.3933 34.2671 25.6569C34.2372 25.6945 34.2073 25.7406 34.1731 25.7866C34.0664 25.9288 33.9681 26.0753 33.8699 26.2217C33.2036 27.1882 32.106 28.8033 31.2305 29.9121C31.7045 30.4351 33.3788 31.8033 34.2458 31.7489C34.3782 31.7405 34.5191 31.7154 34.66 31.682C35.2153 31.5355 35.7406 31.1464 36.125 30.6108C36.5649 29.9832 36.9663 29.3598 37.3251 28.7364C37.3294 28.7364 37.3336 28.7364 37.3379 28.7364C37.8291 27.8786 38.2775 26.9749 38.6363 26.0418C39.2427 24.4686 39.5204 23.0795 39.499 21.8828C39.4947 21.887 39.4905 21.8912 39.4905 21.8954Z" fill="#34BEED"/><path d="M38.8833 17.1925C38.8619 17.1255 38.8406 17.0628 38.815 17C37.6874 17.2343 34.6209 17.6276 32.7417 19.4728C31.3109 20.9331 30.7258 22.9874 30.5507 25.0251C30.5208 25.3473 30.4909 25.6778 30.4909 26C30.4909 25.6778 30.461 25.3473 30.4311 25.0251C30.2517 22.9874 29.6709 20.9289 28.2401 19.4728C26.3609 17.6276 23.2944 17.2343 22.1669 17C22.1412 17.0628 22.1199 17.1297 22.0985 17.1925C21.6629 18.5439 21.9661 20.1381 22.8758 21.1967C24.0589 22.569 25.9125 22.8954 27.2194 24.092C27.9113 24.7238 28.4964 25.4854 29.0089 26.2761C29.278 26.6904 29.5299 27.1171 29.7777 27.5481C29.9314 27.8159 30.4952 28.7782 30.4952 28.7782C30.4952 28.7782 31.0589 27.8201 31.2127 27.5481C31.4604 27.1171 31.7081 26.6904 31.9815 26.2761C32.4982 25.4812 33.0834 24.7238 33.771 24.092C35.0779 22.8996 36.9315 22.5732 38.1145 21.1967C39.02 20.1381 39.3189 18.5439 38.8833 17.1925Z" fill="#1868AF"/></g><path d="M55.986 34.5C55.7407 34.5 55.549 34.4387 55.411 34.316C55.273 34.1933 55.1733 34.04 55.112 33.856L50.19 19.09C50.1593 19.0133 50.144 18.9443 50.144 18.883C50.144 18.745 50.19 18.63 50.282 18.538C50.374 18.446 50.489 18.4 50.627 18.4H52.651C52.8657 18.4 53.0267 18.4613 53.134 18.584C53.2567 18.6913 53.3333 18.7987 53.364 18.906L57.251 30.751L61.115 18.906C61.161 18.7987 61.2377 18.6913 61.345 18.584C61.4677 18.4613 61.6363 18.4 61.851 18.4H63.875C63.9977 18.4 64.105 18.446 64.197 18.538C64.3043 18.63 64.358 18.745 64.358 18.883C64.358 18.9443 64.3427 19.0133 64.312 19.09L59.39 33.856C59.3287 34.04 59.229 34.1933 59.091 34.316C58.953 34.4387 58.7613 34.5 58.516 34.5H55.986ZM68.6639 34.73C67.8665 34.73 67.1459 34.5767 66.5019 34.27C65.8579 33.948 65.3442 33.5263 64.9609 33.005C64.5929 32.4683 64.4089 31.8703 64.4089 31.211C64.4089 30.1377 64.8382 29.2867 65.6969 28.658C66.5709 28.014 67.7209 27.5847 69.1469 27.37L72.2979 26.91V26.427C72.2979 25.783 72.1369 25.2847 71.8149 24.932C71.4929 24.5793 70.9409 24.403 70.1589 24.403C69.6069 24.403 69.1545 24.518 68.8019 24.748C68.4645 24.9627 68.2115 25.254 68.0429 25.622C67.9202 25.8213 67.7439 25.921 67.5139 25.921H65.6969C65.5282 25.921 65.3979 25.875 65.3059 25.783C65.2292 25.691 65.1909 25.5683 65.1909 25.415C65.2062 25.1697 65.3059 24.8707 65.4899 24.518C65.6739 24.1653 65.9652 23.828 66.3639 23.506C66.7625 23.1687 67.2762 22.885 67.9049 22.655C68.5335 22.425 69.2925 22.31 70.1819 22.31C71.1479 22.31 71.9605 22.4327 72.6199 22.678C73.2945 22.908 73.8312 23.2223 74.2299 23.621C74.6285 24.0197 74.9199 24.4873 75.1039 25.024C75.2879 25.5607 75.3799 26.128 75.3799 26.726V33.948C75.3799 34.1013 75.3262 34.2317 75.2189 34.339C75.1115 34.4463 74.9812 34.5 74.8279 34.5H72.9649C72.7962 34.5 72.6582 34.4463 72.5509 34.339C72.4589 34.2317 72.4129 34.1013 72.4129 33.948V33.051C72.2135 33.3423 71.9452 33.6183 71.6079 33.879C71.2705 34.1243 70.8565 34.3313 70.3659 34.5C69.8905 34.6533 69.3232 34.73 68.6639 34.73ZM69.4459 32.545C69.9825 32.545 70.4655 32.43 70.8949 32.2C71.3395 31.97 71.6845 31.6173 71.9299 31.142C72.1905 30.6513 72.3209 30.038 72.3209 29.302V28.819L70.0209 29.187C69.1162 29.325 68.4415 29.5473 67.9969 29.854C67.5522 30.1607 67.3299 30.5363 67.3299 30.981C67.3299 31.3183 67.4295 31.6097 67.6289 31.855C67.8435 32.085 68.1119 32.2613 68.4339 32.384C68.7559 32.4913 69.0932 32.545 69.4459 32.545ZM78.9055 34.5C78.7522 34.5 78.6218 34.4463 78.5145 34.339C78.4072 34.2317 78.3535 34.1013 78.3535 33.948V18.722C78.3535 18.5687 78.4072 18.4383 78.5145 18.331C78.6218 18.2237 78.7522 18.17 78.9055 18.17H80.8145C80.9678 18.17 81.0982 18.2237 81.2055 18.331C81.3128 18.4383 81.3665 18.5687 81.3665 18.722V33.948C81.3665 34.1013 81.3128 34.2317 81.2055 34.339C81.0982 34.4463 80.9678 34.5 80.8145 34.5H78.9055ZM89.5694 34.73C87.8674 34.73 86.5181 34.2393 85.5214 33.258C84.5247 32.2767 83.9881 30.8813 83.9114 29.072C83.8961 28.9187 83.8884 28.727 83.8884 28.497C83.8884 28.2517 83.8961 28.06 83.9114 27.922C83.9727 26.772 84.2334 25.7753 84.6934 24.932C85.1687 24.0887 85.8204 23.4447 86.6484 23C87.4764 22.54 88.4501 22.31 89.5694 22.31C90.8114 22.31 91.8541 22.5707 92.6974 23.092C93.5407 23.598 94.1771 24.311 94.6064 25.231C95.0357 26.1357 95.2504 27.186 95.2504 28.382V28.865C95.2504 29.0183 95.1967 29.1487 95.0894 29.256C94.9821 29.3633 94.8441 29.417 94.6754 29.417H87.0394C87.0394 29.417 87.0394 29.44 87.0394 29.486C87.0394 29.532 87.0394 29.5703 87.0394 29.601C87.0547 30.1377 87.1544 30.636 87.3384 31.096C87.5377 31.5407 87.8214 31.901 88.1894 32.177C88.5727 32.453 89.0251 32.591 89.5464 32.591C89.9757 32.591 90.3361 32.5297 90.6274 32.407C90.9187 32.269 91.1564 32.1157 91.3404 31.947C91.5244 31.7783 91.6547 31.6403 91.7314 31.533C91.8694 31.349 91.9767 31.2417 92.0534 31.211C92.1454 31.165 92.2757 31.142 92.4444 31.142H94.4224C94.5757 31.142 94.6984 31.188 94.7904 31.28C94.8977 31.372 94.9437 31.487 94.9284 31.625C94.9131 31.8703 94.7827 32.1693 94.5374 32.522C94.3074 32.8747 93.9701 33.2197 93.5254 33.557C93.0807 33.8943 92.5211 34.178 91.8464 34.408C91.1871 34.6227 90.4281 34.73 89.5694 34.73ZM87.0394 27.485H92.1224V27.416C92.1224 26.818 92.0227 26.2967 91.8234 25.852C91.6241 25.4073 91.3327 25.0547 90.9494 24.794C90.5661 24.5333 90.1061 24.403 89.5694 24.403C89.0327 24.403 88.5727 24.5333 88.1894 24.794C87.8061 25.0547 87.5147 25.4073 87.3154 25.852C87.1314 26.2967 87.0394 26.818 87.0394 27.416V27.485Z" fill="#FCFCFC"/><defs><clipPath id="clip0_0_3727"><rect width="18" height="19" fill="white" transform="translate(21.5 17)"/></clipPath></defs></svg>';
  let headerContent = "Dear " + organisationName + ",";
  let content =
    "A death notification has been sent, the late " +
    deceasedName +
    ",and \nit was sent it by an " +
    role +
    ", " +
    reporterName +
    ".";
  const canvas = document.createElement("canvas");
  canvas.width = 600;
  canvas.height = 53;
  const ctx = canvas.getContext("2d");
  const v = Canvg.fromString(ctx, header);
  v.start();

  const imageData = canvas.toDataURL("image/png");

  const imgWidth = 210;
  const imgHeight = 20;
  const pageWidth = doc.internal.pageSize.getWidth();
  const pageHeight = doc.internal.pageSize.getHeight();
  const scaleX = pageWidth / imgWidth;
  const scaleY = pageHeight / imgHeight;
  const scale = Math.min(scaleX, scaleY);
  doc.addImage(
    imageData,
    "PNG",
    posX,
    posY,
    imgWidth * scale,
    imgHeight * scale
  );

  doc.text(headerContent, 10, 60);
  doc.text(content, 10, 80);
  posY += 140;
  buttonLines.forEach((line) => {
    doc.setFillColor(200, 200, 200);
    doc.rect(posX, posY, width, 140, "F");
    doc.setTextColor(0);
    doc.text(line, posX + 60, posY + 5);
    posY += 10;
  });
  if (state === 1) {
    doc.save(organisationName + "_email.pdf");
  }

  const blob = doc.output("blob");

  // 使用 FileReader 将 Blob 转换为 Base64 编码字符串
  const reader = new FileReader();
  reader.onload = function () {
    const dataUrl = reader.result;

    console.log("PDF", dataUrl);
    sessionStorage.setItem("PDF", dataUrl);
  };
  reader.readAsDataURL(blob);
};

export default generatePdf;
